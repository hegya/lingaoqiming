<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>临高启明</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		body {
			display: flex;
			height: 100vh;
			overflow: hidden;
		}
		/* 左侧目录栏 */
		.sidebar {
			width: 280px;
			min-width: 180px;
			max-width: calc(100% - 320px);
			background: #f6f8fa;
			border-right: 1px solid #e1e4e8;
			overflow-y: auto;
			padding: 16px;
		}
		/* 拖拽手柄 */
		.resize-handle {
			width: 4px;
			background: #e1e4e8;
			cursor: col-resize;
			transition: background 0.2s;
		}
		.resize-handle:hover {
			background: #0366d6;
		}
		/* 右侧内容区 */
		.content {
			flex: 1;
			padding: 24px;
			overflow-y: auto;
			background: #fff;
		}
		/* 目录样式（仿GitHub） */
		.toc {
			list-style: none;
		}
		.vol-item {
			cursor: pointer;
			padding: 4px 8px;
			border-radius: 3px;
			font-weight: 500;
			margin: 2px 0;
		}
		.vol-item:hover {
			background: #e6ebf1;
		}
		.vol-item.expanded::before { content: "▼ "; font-size: 0.8em; }
		.vol-item.collapsed::before { content: "▶ "; font-size: 0.8em; }
		.chapters-list {
			list-style: none;
			margin: 4px 0 8px 20px;
			display: none;
		}
		.vol-item.expanded + .chapters-list { display: block; }
		.chapter-item {
			padding: 4px 8px;
			border-radius: 3px;
			cursor: pointer;
			color: #0366d6;
			margin: 2px 0;
		}
		.chapter-item:hover {
			background: #e6ebf1;
			text-decoration: underline;
		}
		/* 内容区样式 */
		.chapter-title {
			margin-bottom: 20px;
			color: #24292e;
		}
		.chapter-content {
			line-height: 1.8;
			font-size: 16px;
			white-space: pre-wrap; /* 保留txt换行 */
			margin-bottom: 32px;
			color: #24292e;
		}
		.nav-buttons {
			display: flex;
			gap: 16px;
			justify-content: space-between;
		}
		.nav-btn {
			padding: 8px 16px;
			background: #0366d6;
			color: #fff;
			border: none;
			border-radius: 6px;
			cursor: pointer;
			font-size: 14px;
		}
		.nav-btn:disabled {
			background: #94a3b8;
			cursor: not-allowed;
		}
		/* 响应式适配 */
		@media (max-width: 768px) {
			.sidebar { width: 220px; min-width: 150px; }
			.content { padding: 16px; }
			.chapter-content { font-size: 15px; }
		}
	</style>
</head>
<body>
	<div class="sidebar" id="sidebar">
		<ul class="toc" id="toc"></ul>
	</div>
	<div class="resize-handle" id="resizeHandle"></div>
	<div class="content" id="content">
		<h1>请选择左侧章节开始阅读</h1>
	</div>

	<script>
		// 步骤1：加载目录配置（需创建toc.json，见下方说明）
		let tocData = [];
		let allChapters = []; // 扁平章节列表（用于上下翻页）

		async function init() {
			try {
				// 读取toc.json（需手动配置仓库的vol和章节路径）
				const res = await fetch('toc.json');
				tocData = await res.json();
				
				// 按vol数字排序（避免vol1、vol10、vol2的混乱）
				tocData.sort((a, b) => {
					const numA = parseInt(a.name.replace('vol', ''));
					const numB = parseInt(b.name.replace('vol', ''));
					return numA - numB;
				});

				// 生成扁平章节列表
				allChapters = tocData.flatMap(vol => 
					vol.chapters.map(chap => ({ ...chap, volName: vol.name }))
				);

				// 渲染左侧目录
				renderToc();
			} catch (err) {
				document.getElementById('content').innerHTML = `<p>目录加载失败：${err.message}</p>`;
			}
		}

		// 步骤2：渲染左侧目录
		function renderToc() {
			const tocEl = document.getElementById('toc');
			tocData.forEach(vol => {
				// 渲染vol项（可折叠）
				const volEl = document.createElement('li');
				volEl.className = 'vol-item collapsed';
				volEl.textContent = vol.name;
				tocEl.appendChild(volEl);

				// 渲染章节列表
				const chaptersEl = document.createElement('ul');
				chaptersEl.className = 'chapters-list';
				vol.chapters.forEach(chap => {
					const chapEl = document.createElement('li');
					chapEl.className = 'chapter-item';
					chapEl.textContent = chap.name;
					chapEl.onclick = () => loadChapter(chap.path);
					chaptersEl.appendChild(chapEl);
				});
				tocEl.appendChild(chaptersEl);

				// 折叠/展开逻辑
				volEl.onclick = () => {
					volEl.classList.toggle('expanded');
					volEl.classList.toggle('collapsed');
				};
			});
		}

		// 步骤3：拖拽调整目录宽度
		const sidebar = document.getElementById('sidebar');
		const resizeHandle = document.getElementById('resizeHandle');
		let isResizing = false;

		resizeHandle.addEventListener('mousedown', () => {
			isResizing = true;
			document.addEventListener('mousemove', resizeSidebar);
			document.addEventListener('mouseup', stopResize);
		});

		function resizeSidebar(e) {
			if (!isResizing) return;
			const newWidth = e.clientX;
			if (newWidth >= sidebar.minWidth && newWidth <= sidebar.maxWidth) {
				sidebar.style.width = `${newWidth}px`;
			}
		}

		function stopResize() {
			isResizing = false;
			document.removeEventListener('mousemove', resizeSidebar);
		}

		// 步骤4：加载章节内容+上下翻页
		async function loadChapter(path) {
			try {
				const res = await fetch(path);
				const content = await res.text();
				const contentEl = document.getElementById('content');

				// 找到当前章节的索引
				const currIdx = allChapters.findIndex(chap => chap.path === path);
				const prevChap = allChapters[currIdx - 1];
				const nextChap = allChapters[currIdx + 1];

				// 渲染内容
				contentEl.innerHTML = `
					<h2 class="chapter-title">${allChapters[currIdx].volName} · ${allChapters[currIdx].name}</h2>
					<div class="chapter-content">${content}</div>
					<div class="nav-buttons">
						<button class="nav-btn" ${!prevChap ? 'disabled' : ''}
							onclick="loadChapter('${prevChap?.path || ''}')">
							上一章
						</button>
						<button class="nav-btn" ${!nextChap ? 'disabled' : ''}
							onclick="loadChapter('${nextChap?.path || ''}')">
							下一章
						</button>
					</div>
				`;
			} catch (err) {
				contentEl.innerHTML = `<p>章节加载失败：${err.message}</p>`;
			}
		}

		// 初始化页面
		init();
	</script>
</body>
</html>
